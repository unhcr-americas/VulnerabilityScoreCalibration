<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="VulnerabilityScoreCalibration">
<title>Conjoint analysis: modeling preferences to calibrate vulnerability scoring • VulnerabilityScoreCalibration</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.6/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Conjoint analysis: modeling preferences to calibrate vulnerability scoring">
<meta property="og:description" content="VulnerabilityScoreCalibration">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">VulnerabilityScoreCalibration</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/VulnerabilityScoreCalibration.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/conjointAnalysis.html">Conjoint analysis: modeling preferences to calibrate vulnerability scoring</a>
    <a class="dropdown-item" href="../articles/quadraticVote.html">Quadratic Voting</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/unhcr-americas/VulnerabilityScoreCalibration/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Conjoint analysis: modeling preferences to calibrate vulnerability scoring</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/unhcr-americas/VulnerabilityScoreCalibration/blob/HEAD/vignettes/conjointAnalysis.Rmd" class="external-link"><code>vignettes/conjointAnalysis.Rmd</code></a></small>
      <div class="d-none name"><code>conjointAnalysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-is-conjoint-analysis">What is Conjoint analysis?<a class="anchor" aria-label="anchor" href="#what-is-conjoint-analysis"></a>
</h2>
<p>Conjoint analysis can speed up expert consultations by offering an
<strong>objective mean to compile expert opinions</strong>.</p>
<ul>
<li><p>Conjoint analysis originated in mathematical psychology by
psychometricians.</p></li>
<li><p>often used to evaluate how people make decisions between a set of
different options when considering a number of criteria at the same time
(conjoint features; “trade-offs”).</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="measurement-framework">1. Measurement framework<a class="anchor" aria-label="anchor" href="#measurement-framework"></a>
</h2>
<p>The <a href="https://interagencystandingcommittee.org/system/files/gbna_tools_and_guidance_pkg_final_june_2019.pdf" class="external-link">Joint
Intersectoral Analysis Framework (JIAF)</a> is a theoretical generic
measurement framework to be used for Humanitarian needs assessment. It
specifies three distinct and complementary components of humanitarian
severity and vulnerability indexes:</p>
<ul>
<li>Basic Needs &amp; Living standards</li>
<li>Coping Capacity</li>
<li>Well Being &amp; Community integration</li>
</ul>
<p>This generic model can be contextualised: different sub-indicators
might be used for each of the 3 components depending on cultural and
political situations.</p>
</div>
<div class="section level2">
<h2 id="define-the-combined-alternatives-to-be-compared">2. Define the combined alternatives to be compared<a class="anchor" aria-label="anchor" href="#define-the-combined-alternatives-to-be-compared"></a>
</h2>
<ul>
<li><p>participants rate their preferences for profiles with different
combinations of the attributes or criteria.</p></li>
<li><p>CA then allows to “decompose” or reverse-engineer these ratings
into estimates of how important each criteria or attribute is to a
participant’s ranking decisions</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="utility-scales-agreement-levels">3. Utility scales &amp; Agreement levels<a class="anchor" aria-label="anchor" href="#utility-scales-agreement-levels"></a>
</h2>
<p>Estimating the contribution of each potential answers</p>
<ul>
<li><p>Utility values indicate the overall contribution of each
attribute to how the profiles were rated (e.g. whether number of meals
is more important in vulnerability scoring than access to safe
water).</p></li>
<li><p>A higher <em>“utility”</em> estimate indicates that this level
contributes to a higher vulnerability than the level with the lower
utility estimate (it does not give an absolute value for the utility of
an option, but rather assumes a reference alternative).</p></li>
<li><p>Standard deviation for each level within model allows to better
understand how homogenous the group of experts is with respect to one
level.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="importance-of-each-criteria">4. Importance of each criteria<a class="anchor" aria-label="anchor" href="#importance-of-each-criteria"></a>
</h2>
<ul>
<li><p>Importance of each criteria represent the average importance as
estimed from all experts.</p></li>
<li><p>Importance values will then be used as the weights for each
attribute inside each of our three dimensions.</p></li>
<li><p>Importance values sum to 100%.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ##This is where cleaning is reported, identifying cases for deletion. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #FOR TIME: It is recommended that experts complete the survey during the live exercise. A good window of time is between 10-90 minutes. Cases that were completed faster or slower than this should be considered for deletion. </span></span>
<span><span class="co"># #This code generated the table of flagged entries. click on 'expert_validation' on the Environment to see the table. If you identify any entry flagged as suspect, but that you still want to keep, change the reference values 10 or 90. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># time_validation &lt;- </span></span>
<span><span class="co">#   data |&gt; </span></span>
<span><span class="co">#   transmute(email,</span></span>
<span><span class="co">#             dur = as.duration(end-start) |&gt; as.numeric("minutes"),</span></span>
<span><span class="co">#             too_short = dur &lt; 10,</span></span>
<span><span class="co">#             too_long = dur &gt; 90,</span></span>
<span><span class="co">#             suspect = too_short | too_long)</span></span>
<span><span class="co"># # View(time_validation)</span></span>
<span><span class="co"># data &lt;- data |&gt; anti_join(time_validation |&gt; filter(suspect), by = "email")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #FOR DUPLICATE ENTIRES: Cleaning for duplicates based on name of expert. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># expertdups &lt;- data %&gt;% semi_join(count(., email) %&gt;% filter(n &gt; 1)) #this identifies duplicates by name. Look and manually choose which to keep. </span></span>
<span><span class="co"># #Example manual cleaning. </span></span>
<span><span class="co"># #data &lt;- data[ !(data$"_id" %in% c("12729577")), ] #1 staff had duplicate entries. Kept most recent and shortest time. _id is 12729577</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># #FOR OUTLIERS: Screen for data quality.</span></span>
<span><span class="co"># #Spot repetitive responses (example: answered all options with '3'), responses with little variance (all answers between 6-7, standard deviation less than 2). Also looks for averages that are very different from the rest of the responses. For example, someone's average score is 2 when the rest of the scores are between 6-7. Analysis can be repeated with and without this case to test and compare how it influences the results. </span></span>
<span><span class="co"># #OR</span></span>
<span><span class="co"># #spotting outliers using Mahalanobis distance. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># mah.data &lt;- data %&gt;% select(starts_with("p.")) %&gt;% select(where(is.numeric))</span></span>
<span><span class="co"># expert &lt;- data %&gt;% mutate(mah.dist = mah.data %&gt;% mahalanobis(., center = colMeans(.), cov = cov(.), tol = 1e-21)) #just added this ", tol=1e-21" right after cov(.). After error message: </span></span>
<span><span class="co"># #"system is computationally singular: reciprocal condition number = 4.08252e-20 #Input `mah.dist` is `mah.data %&gt;% mahalanobis(., center = colMeans(.), cov = cov(.))`.</span></span>
<span><span class="co"># outliers &lt;- expert %&gt;% filter(mah.dist &gt; qchisq(.95, df = ncol(mah.data))) #Cutoff point of probability, can be modified. .99 extreme outliers, .95, .90, etc. </span></span>
<span><span class="co"># data &lt;- data %&gt;% anti_join(outliers, by = "_id") #filters the identified out. </span></span>
<span><span class="co"># #PERU - no outliers detected. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># nexpert &lt;- n_distinct(data$email)</span></span>
<span><span class="co"># #names(expert)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="expert-review">Expert Review<a class="anchor" aria-label="anchor" href="#expert-review"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot1 &lt;- </span></span>
<span><span class="co">#   data |&gt; </span></span>
<span><span class="co">#   ggplot(aes(as.numeric(survey_mins))) + </span></span>
<span><span class="co">#   geom_histogram(color = "white", fill = "#0072BC") + </span></span>
<span><span class="co">#   scale_y_continuous(expand = expansion(0, 0)) +</span></span>
<span><span class="co">#   labs(title = "Time to complete survey",</span></span>
<span><span class="co">#        x = "minutes", y = "# of experts") +</span></span>
<span><span class="co">#   theme_unhcr()</span></span></code></pre></div>
<hr>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot2 &lt;- </span></span>
<span><span class="co">#   data |&gt; </span></span>
<span><span class="co">#   summarize(mean = rowMeans(data |&gt; select(starts_with("p.")))) |&gt; </span></span>
<span><span class="co">#   ggplot(aes(mean)) + </span></span>
<span><span class="co">#   geom_histogram(colour = "white", fill = "#0072BC", binwidth = 1) +</span></span>
<span><span class="co">#   scale_y_continuous(expand = expansion(0, 0)) +</span></span>
<span><span class="co">#   labs(title = "Average rating",</span></span>
<span><span class="co">#        x = "average score", y = "# of experts") +</span></span>
<span><span class="co">#   theme_unhcr()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># plot1 + plot2 + plot_annotation(caption = glue::glue("based on {nrow(data)} expert consultations"))</span></span></code></pre></div>
<hr>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cjplot &lt;- function(.x) {</span></span>
<span><span class="co">#   ggplot(.x, aes(estimate, level, xmin = lower, xmax = upper)) + </span></span>
<span><span class="co">#   geom_pointrange() +</span></span>
<span><span class="co">#   scale_y_discrete(labels = \(x) str_wrap(x, 40)) +</span></span>
<span><span class="co">#   facet_wrap(vars(feature), ncol = 1, scales = "free_y") +</span></span>
<span><span class="co">#   labs(caption = glue::glue("The lines around the point represent the confidence interval",</span></span>
<span><span class="co">#                             "(the shorter the line, the more experts are in agreement)",</span></span>
<span><span class="co">#                             .sep = "\n"),</span></span>
<span><span class="co">#        x = NULL, y = NULL) +</span></span>
<span><span class="co">#   theme_unhcr() +</span></span>
<span><span class="co">#   theme(plot.caption = element_text(hjust = 1))</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># cjout &lt;- function(dim, margins, amces, importance, ...) {</span></span>
<span><span class="co">#   cat("---\n\n")</span></span>
<span><span class="co">#   cat(glue::glue("{dim}\n\n"))</span></span>
<span><span class="co">#   cat("---\n\n")</span></span>
<span><span class="co">#   cat("## Marginal Means\n\n")</span></span>
<span><span class="co">#   print(cjplot(margins) + labs(title = dim, subtitle = "Marginal Means"))</span></span>
<span><span class="co">#   cat("\n\n")</span></span>
<span><span class="co">#   cat("## Average Marginal Component Effects (AMCEs)\n\n")</span></span>
<span><span class="co">#   print(cjplot(amces) + labs(title = dim, subtitle = "Average Marginal Component Effects (AMCEs)"))</span></span>
<span><span class="co">#   cat("\n\n")</span></span>
<span><span class="co">#   cat("## Importance Weights\n\n")</span></span>
<span><span class="co">#   print(cjplot(importance) + </span></span>
<span><span class="co">#           scale_x_continuous(labels = scales::label_percent()) + </span></span>
<span><span class="co">#           labs(title = dim, subtitle = "Importance Weights"))</span></span>
<span><span class="co">#   cat("\n\n")</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># pwalk(cjdata, cjout)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Edouard Legoupil.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
